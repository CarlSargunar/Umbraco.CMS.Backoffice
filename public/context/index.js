const o="umb:context-request";class r extends Event{constructor(s,a){super(o,{bubbles:!0,composed:!0,cancelable:!0}),this.contextAlias=s,this.callback=a}}const l=n=>n.type===o,h="umb:context-provide";class v extends Event{constructor(s){super(h,{bubbles:!0,composed:!0}),this.contextAlias=s}}const _=n=>n.type===h;class d{constructor(s,a,t){this.target=s,this._contextAlias=a,this._callback=t,this._handleNewProvider=e=>{!_(e)||this._contextAlias===e.contextAlias&&this.request()}}request(){const s=new r(this._contextAlias,this._callback);this.target.dispatchEvent(s)}attach(){window.addEventListener(h,this._handleNewProvider),this.request()}detach(){window.removeEventListener(h,this._handleNewProvider)}}class u{constructor(s,a,t){this._handleContextRequest=e=>{!l(e)||e.contextAlias===this._contextAlias&&(e.stopPropagation(),e.callback(this._instance))},this.host=s,this._contextAlias=a,this._instance=t}attach(){this.host.addEventListener(o,this._handleContextRequest),this.host.dispatchEvent(new v(this._contextAlias))}detach(){this.host.removeEventListener(o,this._handleContextRequest)}}const x=n=>{class s extends n{constructor(){super(...arguments),this._providers=new Map,this._attached=!1}provideContext(t,e){if(this._providers.has(t))return;const c=new u(this,t,e);this._providers.set(t,c),this._attached&&c.attach()}connectedCallback(){var t;(t=super.connectedCallback)==null||t.call(this),this._attached=!0,this._providers.forEach(e=>e.attach())}disconnectedCallback(){var t;(t=super.disconnectedCallback)==null||t.call(this),this._attached=!1,this._providers.forEach(e=>e.detach())}}return s},b=n=>{class s extends n{constructor(){super(...arguments),this._consumers=new Map,this._resolved=new Map,this._attached=!1}consumeContext(t,e){if(this._consumers.has(t))return;const c=new d(this,t,i=>{e?.(i),!(this._resolved.has(t)&&this._resolved.get(t)===i)&&(this._resolved.set(t,i),this._consumeContextCallback(t,i))});this._consumers.set(t,c),this._attached&&c.attach()}connectedCallback(){var t;(t=super.connectedCallback)==null||t.call(this),this._attached=!0,this._consumers.forEach(e=>e.attach())}disconnectedCallback(){var t;(t=super.disconnectedCallback)==null||t.call(this),this._attached=!1,this._consumers.forEach(e=>e.detach()),this._resolved.clear()}_consumeContextCallback(t,e){}whenAvailableOrChanged(t){}}return s};export{d as UmbContextConsumer,b as UmbContextConsumerMixin,u as UmbContextProvider,x as UmbContextProviderMixin,r as UmbContextRequestEventImplementation,l as isUmbContextRequestEvent,o as umbContextRequestEventType};
